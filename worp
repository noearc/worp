#!/usr/bin/luajit

package.path = package.path .. ";./lib/?.lua"
package.cpath = package.cpath .. ";./lib/?.so;./app/?.so"

--
-- Application libraries
--

P = require "luaposix"

require "app.strict"
require "app.log"
require "app.misc"
require "app.evq"
require "app.sandbox"
require "app.co"
require "app.getopt"


-- 
-- Main code
--

sandbox_init()

local opt, arg = getopt(arg, 'l:')

logf_init(opt.l or "")

--
-- Run any files passed as arguments
--

for _, fname in ipairs(arg) do
	local fd, err = io.open(fname)
	if fd then
		sandbox_load(fd:read("*a"), fname .. ":1")
	else
		logf(LG_WRN, "Could not open %s: %s", fname, err)
	end
end


P.signal(P.SIGINT, os.exit)

logf(LG_INF, "Ready")

mainloop()

-- vi: ft=lua ts=3 sw=3
