
<h1>Jack</h1>

<p>While Worp itself does not depend on Jack, a Jack library is available which
provides some essential functionalty for making sound and music.

<p>To use jack from a worp script, first a jack client object must be created. The
following code creates a jack object 'j', and uses 'foo' as the jack client
name:

<div class=code>
j = Jack("worp")
</div>

<p>Now that a jack client is available, we can use it to do some work:

<h2>Connecting ports</h2>

<p>Connecting Jack ports is done with the ':connect()' method of the jack
client object:

<div class=code>
j:connect(FROM [,TO])
</div>

<p>The connect function does only one thing: it will try to connect all ports
matched by 'FROM' to all ports of the same types matched by 'TO'. If the 'TO'
argument is not given, it will match any jack port in the sytem with the same
port type.

<p>For example, given a system with the following (unconnected) jack clients
and ports:

<p><img src="img/connect-1.png">

<p>When calling:

<div class=code>
j:connect("worp")
</div>

<p>Worp will:

<ul>

	<li> find all ports starting with the FROM string 'worp'.

	<li> find all ports starting with the TO string. Since this string is not
	given, it will match all Jack ports.

	<li> For each of the found FROM ports, it will try to find and connect to
	any TO port of the same type, but with the opposite direction (input/output)

	<li> If the number of matching ports do not match, it will try to do
	the right thing to connect a single mono to two stereo ports.

</ul>

<p>The result will be the following graph:

<p><img src="img/connect-2.png">

<p>For more fine grained control, ports can be specified with more detail:

<div class=code>
j:connect("worp")
j:connect("worp:synth")
j:connect("worp:synth-in")
j:connect("worp:synth-in-1")
</div>

Check the sample scripts for more examples of the usage of the connect() function.

<h2>Handling midi</h2>

<p>The jack client provides two methods for receiving midi data:

<div class=code>
j:on_note(CHANNEL, FN)
j:on_cc(CHANNEL, CC, FN)
</div>

<p>For example, the following snippet will print all received midi notes and control changes for
midi channel 1 and CC #5:

<div class=code>
j:on_note(1, function(note, vel)
	print("key", note, vel)
end)

j:on_cc(1, 5, function(val)
	print("cc", val)
end)
</div>

<h2>Handling audio</h2>

<p> <span class=warn>The DSP API is currently being reworked, so the
	documentation below will be outdated soon</span>

<p>The jack client object can be used to connect Worp to a number of Jack audio
ports. The call

<div class=code>
j:dsp(NAME, INPUT_COUNT, OUTPUT_COUNT, FN)
</div>

<p>will create a number of audio ports with the name NAME-[in|out]-#, and will 
from that moment call the given function FN for each audio sample.

<p>For example, the following function will generate a 1 Khz sine wave on a single Jack
output port called worp:beep-out-1:

<div class=code>
i, di = 0, 1000 * math.pi * 2 / srate
jack:dsp("beep", 0, 1, function()
	i = i + di
	return cos(i)
end)
</div>

<p>Worp provides a convenient abstraction layer for doing digital signal
processing, for more details see the <a href='?dsp'>dsp</a> page.

<!--
vi: ts=3 sw=3
-->
